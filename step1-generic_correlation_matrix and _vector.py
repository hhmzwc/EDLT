# -*- coding: utf-8 -*-
"""

@author: Huimei Han
"""
import tensorflow as tf
import numpy as np
import math
from scipy.stats import pearsonr
from sklearn.preprocessing import MinMaxScaler
from sklearn.feature_selection import chi2
import tensorflow.contrib.slim as slim
from sklearn.preprocessing import OneHotEncoder
import os
from tqdm import tqdm
import matplotlib.pyplot as plt
from sklearn import preprocessing
from sklearn.preprocessing import LabelEncoder
import tempfile
from six.moves import urllib
from sklearn.metrics import accuracy_score
import pandas as pd
from sklearn.model_selection import StratifiedKFold
import tensorflow as tf

seed =7
tf.set_random_seed(1)
path = './dataset'
dirs = os.listdir(path)
random_state_total = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
dataset_num=1
for dir in dirs:
        print('dataset_num',dataset_num)
        ini_data = (np.load('./dataset/' +dir+ '/ini_data.npy'))
        ini_target = (np.load('./dataset/' + dir + '/ini_target.npy'))
        n_feature=ini_data.shape[1]
        cor_label_feature=[]
        cor_feature_feature=[]
        ini_target_dif=set(ini_target)
        label_size=len(ini_target_dif)
        n_features=np.zeros([1,1])
        n_features[0][0]=n_feature
        for tt in range(len(random_state_total)):
                skf = StratifiedKFold(n_splits=5,shuffle=True,random_state=random_state_total[tt])
                fold_number=0
                for train_index, test_index in skf.split(ini_data, ini_target):
                    train_data1, test_data1 = ini_data[train_index], ini_data[test_index]
                    train_label1, test_label1 = ini_target[train_index], ini_target[test_index]
                    min_max_scaler = preprocessing.MinMaxScaler()
                    scaler_data_train = min_max_scaler.fit_transform(train_data1)
                    scaler_data_test = min_max_scaler.transform(test_data1)
                    feature_transpose_train=np.array(scaler_data_train.T)
                    cor_score=[]
                    cor=[]
                    batch_size = len(train_data1)
                    for i in range(n_feature):
                        X = np.vstack([feature_transpose_train[i, :], train_label1])
                        d2 = np.abs(np.corrcoef(X)[0][1])
                        cor_score.append(d2)
                    cor_score = np.array(cor_score)
                    ee=np.argsort(-cor_score)
                    for kk in range(n_feature):
                        cor_label_feature.append(ee[kk])
                    for i in range(n_feature):
                        print(i)
                        cor_score_feature = []
                        for jj in range(n_feature):
                            X = np.vstack([feature_transpose_train[i, :], feature_transpose_train[jj, :]])
                            d2 = np.abs(np.corrcoef(X)[0][1])
                            cor_feature_feature.append(d2)
                    fold_number=fold_number+1
        cor_label_feature=np.array(cor_label_feature)
        cor_feature_feature=np.array(cor_feature_feature)
        np.savetxt('./dataset/' + dir + '/correlation/cor_label_indexp.dat', cor_label_feature)
        np.savetxt('./dataset/' + dir +'/correlation/cor_score_matrixp.dat',cor_feature_feature)
        np.savetxt('./dataset/' + dir + '/correlation/num_feature.dat', n_features)
        dataset_num=dataset_num+1





















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































